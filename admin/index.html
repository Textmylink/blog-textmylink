<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TextMyLink CMS</title>
  </head>
  <body>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script>
      if (window.netlifyIdentity) {
        window.netlifyIdentity.on("init", function (user) {
          if (!user) {
            window.netlifyIdentity.on("login", function () {
              document.location.href = "/admin/";
            });
          }
        });
      }
    </script>
    <script>
      window.process = window.process || { env: { NODE_ENV: "production" } };
      window.CMS_MANUAL_INIT = true;
    </script>
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
    <script>
      (function initCms() {
        if (window.CMS && typeof window.CMS.init === "function") {
          window.CMS.init();
          setupIdentityUI();
          setupMobileEnhancements();
          setupCustomDashboard();
          return;
        }
        if (window.NetlifyCmsApp && typeof window.NetlifyCmsApp.init === "function") {
          window.NetlifyCmsApp.init();
          setupIdentityUI();
          setupMobileEnhancements();
          setupCustomDashboard();
          return;
        }
        const message = "Netlify CMS failed to load. Check the browser console for details.";
        console.error(message);
        document.body.insertAdjacentHTML("beforeend", `<p>${message}</p>`);
      })();

      function setupIdentityUI() {
        if (!window.netlifyIdentity) {
          return;
        }

        const hideModalTabs = () => {
          const modal = document.querySelector(".netlify-identity-modal");
          if (!modal) return;

          const tabs = modal.querySelector("[data-netlify-identity-menu]");
          if (tabs) {
            tabs.style.display = "none";
          }

          const links = modal.querySelectorAll("[data-netlify-identity-button]");
          links.forEach((button) => {
            const text = (button.textContent || "").toLowerCase();
            if (text.includes("sign up") || text.includes("signup") || text.includes("register")) {
              button.remove();
            }
          });

          const heading = modal.querySelector(".netlify-identity-title");
          if (heading) {
            heading.textContent = "Log in";
          }
        };

        window.netlifyIdentity.on("open", () => {
          hideModalTabs();
          const observer = new MutationObserver(() => hideModalTabs());
          const modal = document.querySelector(".netlify-identity-modal");
          if (modal) {
            observer.observe(modal, { childList: true, subtree: true });
          }
        });
      }

      function setupMobileEnhancements() {
        const MOBILE_QUERY = window.matchMedia("(max-width: 900px)");
        const state = {
          button: null,
          overlay: null,
          nav: null,
          panel: null,
          topBar: null,
          fab: null
        };

        let applyScheduled = false;

        const applyTweaks = () => {
          applyScheduled = false;
          const root = document.getElementById("nc-root");
          if (!root) return;

          const isMobile = MOBILE_QUERY.matches;
          const sidebar = findSidebar(root);

          if (isMobile) {
            ensureMobileTopBar(state);
            ensureMobileCreateFab(root, state);
          } else {
            removeMobileCreateFab(state);
            resetMobileTopBar(state);
          }

          if (sidebar) {
            if (isMobile) {
              ensureMobileNav(sidebar, state);
            } else {
              resetMobileNav(sidebar, state);
            }
          } else {
            resetMobileNav(null, state);
          }

          const layout = sidebar ? findFlexParent(sidebar) : null;
          if (layout) {
            if (isMobile) {
              applyMobileStyles(layout, {
                display: "block",
                width: "100%",
                gridTemplateColumns: "minmax(0, 1fr)",
                margin: "0"
              });
            } else {
              resetMobileStyles(layout);
            }
          }

          const mainPane =
            root.querySelector('[data-testid="editor-pane"]') ||
            root.querySelector("[role='main']") ||
            root.querySelector("main");
          if (mainPane) {
            if (isMobile) {
              applyMobileStyles(mainPane, {
                marginLeft: "0",
                width: "100%",
                maxWidth: "100%",
                gridColumn: "1 / -1",
                paddingLeft: "0",
                paddingRight: "0"
              });
            } else {
              resetMobileStyles(mainPane);
            }
          }

          const modal = findMediaModal();
          if (modal) {
            if (isMobile) {
              applyMobileStyles(modal, {
                width: "100%",
                maxWidth: "100%",
                left: "0",
                right: "0",
                margin: "0",
                height: "100%",
                maxHeight: "100%"
              });

              const modalContent =
                modal.querySelector(".nc-media-library-content") ||
                modal.querySelector("[class*='MediaLibraryContent']");
              if (modalContent) {
                applyMobileStyles(modalContent, { maxWidth: "100%" });
              }
            } else {
              resetMobileStyles(modal);
              const modalContent =
                modal.querySelector(".nc-media-library-content") ||
                modal.querySelector("[class*='MediaLibraryContent']");
              if (modalContent) {
                resetMobileStyles(modalContent);
              }
            }
          }

          if (!isMobile) {
            setCollectionsOpen(false, state);
          }
        };

        const scheduleApply = () => {
          if (applyScheduled) return;
          applyScheduled = true;
          requestAnimationFrame(applyTweaks);
        };

        const observer = new MutationObserver(() => scheduleApply());
        const observeRoot = () => {
          const root = document.getElementById("nc-root");
          if (!root) {
            requestAnimationFrame(observeRoot);
            return;
          }
          observer.observe(root, { childList: true, subtree: true });
          scheduleApply();
        };

        observeRoot();
        if (typeof MOBILE_QUERY.addEventListener === "function") {
          MOBILE_QUERY.addEventListener("change", scheduleApply);
        } else if (typeof MOBILE_QUERY.addListener === "function") {
          MOBILE_QUERY.addListener(scheduleApply);
        }
        window.addEventListener("resize", scheduleApply, { passive: true });
        document.addEventListener("keydown", (event) => {
          if (event.key === "Escape") {
            setCollectionsOpen(false, state);
          }
        });
      }

      function setupCustomDashboard() {
        const cms = window.CMS;
        if (!cms) {
          return;
        }

        const state = {
          overlay: null,
          drafts: [],
          published: [],
          sortMode: "newest",
          loading: false,
          refreshToken: 0,
          visible: false
        };

        const ensureStyles = () => {
          if (document.getElementById("cms-dashboard-styles")) {
            return;
          }

          const style = document.createElement("style");
          style.id = "cms-dashboard-styles";
          style.textContent = `
            body.cms-dashboard-active {
              background: #f5f5f5;
            }

            .cms-dashboard-hidden {
              position: absolute !important;
              width: 1px !important;
              height: 1px !important;
              overflow: hidden !important;
              clip: rect(0 0 0 0) !important;
              white-space: nowrap !important;
            }

            .cms-dashboard {
              position: relative;
              display: none;
              min-height: 100vh;
              padding: 2.5rem 1.5rem 3.5rem;
              box-sizing: border-box;
              background: #f5f5f5;
              color: #111827;
              font-family: "Inter", "Helvetica Neue", Arial, sans-serif;
            }

            .cms-dashboard.is-visible {
              display: flex;
              flex-direction: column;
              align-items: stretch;
              gap: 1.5rem;
            }

            .cms-dashboard__inner {
              width: min(480px, 100%);
              margin: 0 auto;
              display: flex;
              flex-direction: column;
              gap: 1.5rem;
            }

            .cms-dashboard__title {
              font-size: clamp(2rem, 5vw, 2.5rem);
              font-weight: 700;
              margin: 0;
            }

            .cms-dashboard__cta {
              display: inline-flex;
              align-items: center;
              justify-content: center;
              gap: 0.65rem;
              padding: 0.9rem 1.25rem;
              border-radius: 0.95rem;
              font-size: 1rem;
              font-weight: 600;
              border: none;
              cursor: pointer;
              background: #111827;
              color: #ffffff;
              box-shadow: 0 10px 24px rgba(15, 23, 42, 0.25);
              transition: transform 0.15s ease, box-shadow 0.15s ease;
            }

            .cms-dashboard__cta:hover,
            .cms-dashboard__cta:focus {
              transform: translateY(-1px);
              box-shadow: 0 16px 30px rgba(15, 23, 42, 0.25);
            }

            .cms-dashboard__section {
              display: flex;
              flex-direction: column;
              gap: 0.75rem;
            }

            .cms-dashboard__section-heading {
              font-size: 1rem;
              font-weight: 600;
              margin: 0;
              text-transform: uppercase;
              letter-spacing: 0.08em;
              color: #374151;
            }

            .cms-dashboard__list {
              display: flex;
              flex-direction: column;
              gap: 0.85rem;
            }

            .cms-dashboard__entry {
              display: flex;
              flex-direction: column;
              align-items: flex-start;
              gap: 0.35rem;
              text-align: left;
              border: none;
              padding: 1rem 1.15rem;
              border-radius: 0.9rem;
              background: #ffffff;
              box-shadow: 0 8px 18px rgba(15, 23, 42, 0.08);
              font-size: 1rem;
              line-height: 1.4;
              font-weight: 500;
              color: inherit;
              cursor: pointer;
              transition: transform 0.12s ease, box-shadow 0.12s ease;
            }

            .cms-dashboard__entry:hover,
            .cms-dashboard__entry:focus {
              transform: translateY(-1px);
              box-shadow: 0 14px 28px rgba(15, 23, 42, 0.12);
            }

            .cms-dashboard__entry-title {
              font-size: 1.02rem;
              font-weight: 600;
              color: #111827;
              word-break: break-word;
            }

            .cms-dashboard__entry-meta {
              font-size: 0.82rem;
              font-weight: 500;
              color: #6b7280;
            }

            .cms-dashboard__empty {
              margin: 0;
              padding: 1rem 1.15rem;
              border-radius: 0.9rem;
              background: #ffffff;
              color: #6b7280;
              font-size: 0.95rem;
              box-shadow: 0 4px 12px rgba(15, 23, 42, 0.05);
            }

            .cms-dashboard__footer {
              margin-top: 0.5rem;
              display: grid;
              gap: 0.75rem;
              grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            }

            .cms-dashboard__secondary {
              display: inline-flex;
              align-items: center;
              justify-content: center;
              gap: 0.5rem;
              padding: 0.85rem 1.15rem;
              border-radius: 0.9rem;
              border: 1px solid #d1d5db;
              background: #ffffff;
              font-size: 0.95rem;
              font-weight: 600;
              cursor: pointer;
              color: #111827;
              box-shadow: 0 4px 12px rgba(15, 23, 42, 0.05);
              transition: border-color 0.15s ease, box-shadow 0.15s ease, transform 0.15s ease;
            }

            .cms-dashboard__secondary:hover,
            .cms-dashboard__secondary:focus {
              transform: translateY(-1px);
              border-color: #9ca3af;
              box-shadow: 0 10px 20px rgba(15, 23, 42, 0.1);
            }

            .cms-dashboard__loading {
              font-size: 0.9rem;
              color: #6b7280;
            }

            @media (max-width: 520px) {
              .cms-dashboard {
                padding: 2rem 1.15rem 2.5rem;
              }

              .cms-dashboard__inner {
                gap: 1.25rem;
              }

              .cms-dashboard__cta {
                padding: 0.85rem 1.05rem;
                font-size: 0.98rem;
              }

              .cms-dashboard__entry {
                padding: 0.9rem 1rem;
              }
            }
          `;

          document.head.appendChild(style);
        };

        const ensureOverlay = () => {
          if (state.overlay && document.body.contains(state.overlay)) {
            return state.overlay;
          }

          ensureStyles();

          const overlay = document.createElement("div");
          overlay.className = "cms-dashboard";
          overlay.setAttribute("role", "region");
          overlay.setAttribute("aria-label", "Admin Portal Overview");
          overlay.setAttribute("aria-hidden", "true");

          overlay.innerHTML = `
            <div class="cms-dashboard__inner">
              <header>
                <h1 class="cms-dashboard__title">Admin Portal</h1>
              </header>
              <button type="button" class="cms-dashboard__cta" data-dashboard-action="new">
                <span aria-hidden="true">＋</span>
                <span>New Post</span>
              </button>
              <section class="cms-dashboard__section" data-dashboard-section="drafts">
                <h2 class="cms-dashboard__section-heading">Drafts</h2>
                <div class="cms-dashboard__list" data-dashboard-list="drafts"></div>
              </section>
              <section class="cms-dashboard__section" data-dashboard-section="published">
                <h2 class="cms-dashboard__section-heading">Published</h2>
                <div class="cms-dashboard__list" data-dashboard-list="published"></div>
              </section>
              <div class="cms-dashboard__footer">
                <button type="button" class="cms-dashboard__secondary" data-dashboard-action="sort"></button>
                <button type="button" class="cms-dashboard__secondary" data-dashboard-action="media">Media</button>
              </div>
              <p class="cms-dashboard__loading" data-dashboard-loading hidden>Loading…</p>
            </div>
          `;

          document.body.appendChild(overlay);
          state.overlay = overlay;

          overlay.querySelector("[data-dashboard-action='new']")?.addEventListener("click", () => {
            navigateToHash("#/collections/blog_drafts/new");
          });

          overlay.querySelector("[data-dashboard-action='media']")?.addEventListener("click", () => {
            navigateToHash("#/media");
          });

          overlay.querySelector("[data-dashboard-action='sort']")?.addEventListener("click", () => {
            state.sortMode = state.sortMode === "alphabetical" ? "newest" : "alphabetical";
            renderLists();
          });

          return overlay;
        };

        const hideDashboard = () => {
          const overlay = ensureOverlay();
          overlay.classList.remove("is-visible");
          overlay.setAttribute("aria-hidden", "true");
          state.visible = false;
          document.body.classList.remove("cms-dashboard-active");
          const root = document.getElementById("nc-root");
          if (root) {
            root.classList.remove("cms-dashboard-hidden");
          }
        };

        const showDashboard = () => {
          const overlay = ensureOverlay();
          overlay.classList.add("is-visible");
          overlay.setAttribute("aria-hidden", "false");
          state.visible = true;
          document.body.classList.add("cms-dashboard-active");
          const root = document.getElementById("nc-root");
          if (root) {
            root.classList.add("cms-dashboard-hidden");
          }
          updateSortLabel();
          refreshEntries();
        };

        const navigateToHash = (hash) => {
          hideDashboard();
          requestAnimationFrame(() => {
            window.location.hash = hash;
          });
        };

        const formatDate = (value) => {
          if (!value) {
            return "";
          }
          const date = new Date(value);
          if (Number.isNaN(date.getTime())) {
            return "";
          }
          try {
            return new Intl.DateTimeFormat(undefined, {
              month: "short",
              day: "numeric",
              year: "numeric"
            }).format(date);
          } catch (error) {
            return date.toISOString().split("T")[0];
          }
        };

        const escapeHtml = (value) => {
          if (typeof value !== "string") {
            return value;
          }
          return value
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#39;");
        };

        const toPlainEntry = (entry) => {
          if (!entry) {
            return null;
          }

          const read = (source, key) => {
            if (!source) return undefined;
            if (typeof source.get === "function") {
              return source.get(key);
            }
            return source[key];
          };

          const dataValue = (() => {
            const data = read(entry, "data");
            if (!data) return {};
            if (typeof data.toJS === "function") {
              return data.toJS();
            }
            if (typeof data.toJSON === "function") {
              return data.toJSON();
            }
            if (typeof data.get === "function") {
              const result = {};
              data.forEach((value, key) => {
                result[key] = value;
              });
              return result;
            }
            return data;
          })();

          const slug =
            read(entry, "slug") ||
            read(entry, "path") ||
            read(entry, "file") ||
            (dataValue && dataValue.slug) ||
            null;

          const title =
            dataValue?.title ||
            read(entry, "label") ||
            (slug ? slug.replace(/[-_]/g, " ") : "Untitled Post");

          const date = dataValue?.date || read(entry, "updatedOn") || read(entry, "updated_at") || null;

          return {
            slug,
            title,
            date,
            collection: read(entry, "collection") || dataValue?.collection || null
          };
        };

        const sortEntries = (entries) => {
          const sorted = entries.slice();
          if (state.sortMode === "alphabetical") {
            sorted.sort((a, b) => a.title.localeCompare(b.title));
          } else {
            sorted.sort((a, b) => {
              const dateA = a.date ? new Date(a.date).getTime() : 0;
              const dateB = b.date ? new Date(b.date).getTime() : 0;
              if (dateA && dateB && dateA !== dateB) {
                return dateB - dateA;
              }
              return a.title.localeCompare(b.title);
            });
          }
          return sorted;
        };

        const updateSortLabel = () => {
          const overlay = ensureOverlay();
          const button = overlay.querySelector("[data-dashboard-action='sort']");
          if (button) {
            button.textContent = state.sortMode === "alphabetical" ? "Sort: A–Z" : "Sort: Newest";
          }
        };

        const renderSection = (section, entries) => {
          const overlay = ensureOverlay();
          const container = overlay.querySelector(`[data-dashboard-list='${section}']`);
          if (!container) {
            return;
          }

          container.innerHTML = "";

          const sortedEntries = sortEntries(entries);

          if (sortedEntries.length === 0) {
            const empty = document.createElement("p");
            empty.className = "cms-dashboard__empty";
            empty.textContent = section === "drafts" ? "No drafts yet." : "No published posts yet.";
            container.appendChild(empty);
            return;
          }

          sortedEntries.forEach((entry) => {
            const item = document.createElement("button");
            item.type = "button";
            item.className = "cms-dashboard__entry";
            const title = escapeHtml(entry.title || "Untitled Post");
            const meta = formatDate(entry.date);
            item.innerHTML = `
              <span class="cms-dashboard__entry-title">${title}</span>
              ${meta ? `<span class="cms-dashboard__entry-meta">${meta}</span>` : ""}
            `;
            item.addEventListener("click", () => {
              if (!entry.slug) {
                return;
              }
              const collection = section === "drafts" ? "blog_drafts" : "blog_published";
              const encodedSlug = encodeURIComponent(entry.slug);
              navigateToHash(`#/collections/${collection}/entries/${encodedSlug}`);
            });
            container.appendChild(item);
          });
        };

        const setLoading = (loading) => {
          state.loading = loading;
          const overlay = ensureOverlay();
          const indicator = overlay.querySelector("[data-dashboard-loading]");
          if (!indicator) {
            return;
          }
          indicator.hidden = !loading;
        };

        const renderLists = () => {
          updateSortLabel();
          renderSection("drafts", state.drafts);
          renderSection("published", state.published);
        };

        const loadCollectionEntries = async (collectionName) => {
          const collection = typeof cms.getCollection === "function" ? cms.getCollection(collectionName) : null;
          if (!collection) {
            return [];
          }

          const backend = typeof cms.getBackend === "function" ? cms.getBackend() : null;
          if (!backend || typeof backend.listEntries !== "function") {
            return [];
          }

          try {
            const result = await backend.listEntries(collection);
            const entries = Array.isArray(result?.entries)
              ? result.entries
              : result?.entries?.toArray?.() || result?.entries?.toJS?.() || result;

            if (!entries) {
              return [];
            }

            return entries
              .map((entry) => toPlainEntry(entry))
              .filter(Boolean);
          } catch (error) {
            console.error(`Failed to load entries for ${collectionName}:`, error);
            return [];
          }
        };

        const refreshEntries = async () => {
          if (!state.visible) {
            return;
          }

          const currentToken = ++state.refreshToken;
          setLoading(true);

          const [drafts, published] = await Promise.all([
            loadCollectionEntries("blog_drafts"),
            loadCollectionEntries("blog_published")
          ]);

          if (currentToken !== state.refreshToken || !state.visible) {
            if (currentToken === state.refreshToken) {
              setLoading(false);
            }
            return;
          }

          state.drafts = drafts;
          state.published = published;
          setLoading(false);
          renderLists();
        };

        const handleRouteChange = () => {
          const hash = window.location.hash || "";
          const normalized = hash.replace(/#/, "#");
          const entryRoute = /^#\/collections\/[^/]+\/(entries|new)/i;
          const mediaRoute = /^#\/media/i;
          const workflowRoute = /^#\/workflow/i;
          const isEntryView = entryRoute.test(normalized) || mediaRoute.test(normalized) || workflowRoute.test(normalized);
          const isCollectionsRoot =
            normalized === "" ||
            normalized === "#" ||
            normalized === "#/" ||
            /^#\/collections(\/[^/]+)?\/?$/i.test(normalized);

          if (isEntryView) {
            hideDashboard();
          } else if (isCollectionsRoot) {
            showDashboard();
          }
        };

        const handleCmsEvents = () => {
          if (!cms.registerEventListener) {
            return;
          }

          const events = [
            "entryPersisted",
            "entryDeleted",
            "entryDraftCreated",
            "entryDraftDiscarded"
          ];

          events.forEach((name) => {
            cms.registerEventListener({
              name,
              handler: () => {
                if (state.visible) {
                  refreshEntries();
                }
              }
            });
          });
        };

        const init = () => {
          ensureOverlay();
          handleRouteChange();
          window.addEventListener("hashchange", handleRouteChange, { passive: true });
          handleCmsEvents();
        };

        if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", init, { once: true });
        } else {
          init();
        }
      }

      function applyMobileStyles(element, styles) {
        if (!element) return;
        if (element.dataset.mobileOriginalStyle === undefined) {
          element.dataset.mobileOriginalStyle = element.getAttribute("style") || "";
        }
        Object.assign(element.style, styles);
      }

      function resetMobileStyles(element) {
        if (!element || element.dataset.mobileOriginalStyle === undefined) {
          return;
        }
        const original = element.dataset.mobileOriginalStyle;
        if (original) {
          element.setAttribute("style", original);
        } else {
          element.removeAttribute("style");
        }
        delete element.dataset.mobileOriginalStyle;
      }

      function ensureMobileNav(nav, state) {
        if (!nav) return;
        state.nav = nav;
        applyMobileStyles(nav, { display: "none" });

        const topBar = ensureMobileTopBar(state);

        if (!state.panel) {
          const panelTag = nav.tagName.toLowerCase() === "nav" ? "nav" : "div";
          const panel = document.createElement(panelTag);
          panel.id = "cms-mobile-collections-panel";
          panel.dataset.mobileCollectionsPanel = "true";
          panel.setAttribute("role", "navigation");
          panel.setAttribute("aria-label", "Collections");
          panel.setAttribute("tabindex", "-1");
          panel.setAttribute("aria-hidden", "true");
          document.body.appendChild(panel);
          panel.addEventListener("click", (event) => {
            if (event.target.closest("a, button")) {
              setCollectionsOpen(false, state);
            }
          });
          state.panel = panel;
        }

        if (state.panel) {
          state.panel.innerHTML = nav.innerHTML;
          state.panel.setAttribute(
            "aria-hidden",
            document.body.classList.contains("cms-collections-open") ? "false" : "true"
          );
        }

        const button = ensureMobileNavButton(state, topBar, state.panel ? state.panel.id : null);
        const overlay = ensureMobileNavOverlay(state);
        state.button = button;
        state.overlay = overlay;
      }

      function resetMobileNav(nav, state) {
        const originalNav = nav || state.nav;
        if (originalNav) {
          resetMobileStyles(originalNav);
        }
        if (state.panel) {
          state.panel.remove();
          state.panel = null;
        }
        if (state.button) {
          state.button.remove();
          state.button = null;
        }
        setCollectionsOpen(false, state);
      }

      function ensureMobileNavButton(state, topBar, controlsId) {
        let button = document.getElementById("cms-mobile-collections-button");
        if (!button) {
          button = document.createElement("button");
          button.id = "cms-mobile-collections-button";
          button.type = "button";
          button.setAttribute("aria-haspopup", "true");
          button.innerHTML = '<span aria-hidden="true">â˜°</span> Collections';
          button.addEventListener("click", () => {
            const shouldOpen = !document.body.classList.contains("cms-collections-open");
            setCollectionsOpen(shouldOpen, state);
          });
        }
        if (topBar && button.parentNode !== topBar) {
          topBar.appendChild(button);
        }
        if (controlsId) {
          button.setAttribute("aria-controls", controlsId);
        } else {
          button.removeAttribute("aria-controls");
        }
        button.setAttribute(
          "aria-expanded",
          document.body.classList.contains("cms-collections-open") ? "true" : "false"
        );
        return button;
      }

      function ensureMobileNavOverlay(state) {
        let overlay = document.getElementById("cms-mobile-collections-overlay");
        if (!overlay) {
          overlay = document.createElement("div");
          overlay.id = "cms-mobile-collections-overlay";
          overlay.style.display = "none";
          document.body.appendChild(overlay);
        }
        if (!overlay.dataset.mobileBound) {
          overlay.dataset.mobileBound = "true";
          overlay.addEventListener("click", () => setCollectionsOpen(false, state));
        }
        overlay.style.display = document.body.classList.contains("cms-collections-open") ? "block" : "none";
        return overlay;
      }

      function ensureMobileTopBar(state) {
        if (state.topBar && document.body.contains(state.topBar)) {
          return state.topBar;
        }
        let bar = document.getElementById("cms-mobile-toolbar");
        if (!bar) {
          bar = document.createElement("div");
          bar.id = "cms-mobile-toolbar";
          document.body.appendChild(bar);
        } else if (bar.parentNode !== document.body) {
          document.body.appendChild(bar);
        }
        state.topBar = bar;
        return bar;
      }

      function resetMobileTopBar(state) {
        if (state.button) {
          state.button.remove();
          state.button = null;
        }
        if (state.topBar) {
          state.topBar.remove();
          state.topBar = null;
        }
      }

      function ensureMobileCreateFab(root, state) {
        const isAuthRoute = () => {
          const hash = window.location.hash || "";
          if (!hash || hash === "#/") {
            return true;
          }
          const normalized = hash.toLowerCase();
          return (
            normalized.startsWith("#/login") ||
            normalized.startsWith("#/recover") ||
            normalized.startsWith("#/forgot") ||
            normalized.startsWith("#/invite")
          );
        };

        const targetCollection = getDefaultCollectionName();
        if (!targetCollection || isAuthRoute()) {
          removeMobileCreateFab(state);
          return;
        }

        const targetRoute = `#/collections/${encodeURIComponent(targetCollection)}/new`;

        if (!state.fab || !document.body.contains(state.fab)) {
          const fab = document.createElement("a");
          fab.id = "cms-mobile-create-post";
          fab.href = targetRoute;
          fab.className = "cms-mobile-create-post";
          fab.setAttribute("role", "button");
          fab.setAttribute("aria-label", "Create a new blog post");
          fab.innerHTML =
            '<span aria-hidden="true" class="cms-mobile-create-post__icon">＋</span><span>New Blog Post</span>';
          fab.addEventListener("click", (event) => {
            event.preventDefault();
            window.location.hash = targetRoute;
          });
          document.body.appendChild(fab);
          state.fab = fab;
        }

        if (state.fab) {
          state.fab.href = targetRoute;
          state.fab.dataset.collection = targetCollection;
          state.fab.classList.add("visible");
        }
      }

      function removeMobileCreateFab(state) {
        if (state.fab) {
          state.fab.remove();
          state.fab = null;
        }
      }

      function setCollectionsOpen(open, state) {
        const body = document.body;
        if (open) {
          body.classList.add("cms-collections-open");
        } else {
          body.classList.remove("cms-collections-open");
        }

        if (state.button) {
          state.button.setAttribute("aria-expanded", open ? "true" : "false");
        }
        if (state.panel) {
          state.panel.setAttribute("aria-hidden", open ? "false" : "true");
          state.panel.setAttribute("tabindex", open ? "0" : "-1");
        }
        if (state.overlay) {
          state.overlay.style.display = open ? "block" : "none";
        }
      }

      function findSidebar(root) {
        const navCandidates = root.querySelectorAll("[role='navigation'], aside");
        for (const el of navCandidates) {
          const text = el.textContent || "";
          if (text.toLowerCase().includes("collections")) {
            return el;
          }
        }
        return navCandidates[0] || null;
      }

      function findFlexParent(element) {
        let current = element.parentElement;
        while (current) {
          const style = window.getComputedStyle(current);
          if (style.display.includes("flex")) {
            return current;
          }
          current = current.parentElement;
        }
        return null;
      }

      function findMediaModal() {
        const dialogs = document.querySelectorAll("[role='dialog'], [data-testid*='modal']");
        for (const dialog of dialogs) {
          const text = (dialog.getAttribute("aria-label") || dialog.textContent || "").toLowerCase();
          if (text.includes("media library") || text.includes("upload")) {
            return dialog;
          }
        }
        return null;
      }

      function getDefaultCollectionName() {
        const hash = window.location.hash || "";
        const hashMatch = hash.match(/#\/collections\/([^/]+)/);
        if (hashMatch && hashMatch[1]) {
          return decodeURIComponent(hashMatch[1]);
        }

        try {
          const cms = window.CMS;
          if (cms && typeof cms.getCollections === "function") {
            const collections = cms.getCollections();
            if (collections && typeof collections.valueSeq === "function") {
              const first = collections
                .valueSeq()
                .find((collection) => collection && collection.get && collection.get("create") !== false);
              if (first && typeof first.get === "function") {
                return first.get("name");
              }
            }
          }
        } catch (error) {
          console.warn("Unable to derive collection from CMS state:", error);
        }

        try {
          const globalConfig =
            window.__DECAP_CMS_INITIAL_STATE__?.config || window.__NETLIFY_CMS_DATA__?.config || null;
          if (globalConfig && Array.isArray(globalConfig.collections) && globalConfig.collections.length > 0) {
            const firstWritable = globalConfig.collections.find((collection) => collection && collection.create !== false);
            if (firstWritable && firstWritable.name) {
              return firstWritable.name;
            }
          }
        } catch (error) {
          console.warn("Unable to derive collection from global config:", error);
        }

        return "blog";
      }
    </script>
  </body>
</html>
    <style>
      #cms-mobile-toolbar,
      #cms-mobile-collections-button,
      #cms-mobile-collections-overlay,
      #cms-mobile-create-post {
        display: none;
      }

      @media (max-width: 900px) {
        body.cms-collections-open {
          overflow: hidden;
        }

        #nc-root {
          overflow-x: hidden;
          padding-top: 5.75rem;
        }

        #cms-mobile-toolbar {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          z-index: 1003;
          display: flex;
          justify-content: flex-end;
          gap: 0.75rem;
          align-items: center;
          padding: 0.65rem 0.75rem;
          background: rgba(248, 250, 252, 0.96);
          backdrop-filter: blur(12px);
          border-bottom: 1px solid rgba(148, 163, 184, 0.28);
        }

        #cms-mobile-collections-button {
          position: static;
          margin: 0;
          flex: 0 0 auto;
          display: inline-flex;
          align-items: center;
          gap: 0.4rem;
          padding: 0.55rem 0.9rem;
          border-radius: 999px;
          border: none;
          background: #1f2937;
          color: #fff;
          font-size: 0.9rem;
          font-weight: 600;
          box-shadow: 0 10px 24px rgba(15, 23, 42, 0.18);
          cursor: pointer;
        }

        #cms-mobile-collections-button span[aria-hidden="true"] {
          font-size: 1.05rem;
          line-height: 1;
        }

        body.cms-collections-open #cms-mobile-collections-button {
          background: #3730a3;
        }

        #cms-mobile-create-post {
          position: fixed;
          right: 1rem;
          bottom: calc(1.15rem + env(safe-area-inset-bottom, 0));
          z-index: 1003;
          display: none;
          align-items: center;
          gap: 0.45rem;
          padding: 0.65rem 1.15rem;
          border-radius: 999px;
          border: none;
          background: #2563eb;
          color: #fff;
          font-weight: 600;
          font-size: 0.95rem;
          box-shadow: 0 12px 26px rgba(37, 99, 235, 0.22);
          text-decoration: none;
          cursor: pointer;
        }

        #cms-mobile-create-post span[aria-hidden="true"] {
          font-size: 1.15rem;
          line-height: 1;
        }

        #cms-mobile-create-post.visible {
          display: inline-flex;
        }

        #cms-mobile-collections-overlay {
          position: fixed;
          inset: 0;
          background: rgba(15, 23, 42, 0.35);
          z-index: 1001;
        }

        body.cms-collections-open #cms-mobile-collections-overlay {
          display: block;
        }

        [data-mobile-collections-panel] {
          position: fixed !important;
          top: 0;
          left: 0;
          bottom: 0;
          width: min(82vw, 320px);
          max-width: 92vw;
          background: #ffffff;
          z-index: 1002;
          transform: translateX(-110%);
          transition: transform 0.25s ease;
          box-shadow: 12px 0 32px rgba(15, 23, 42, 0.28);
          padding: 1.25rem 1rem;
          overflow-y: auto;
        }

        body.cms-collections-open [data-mobile-collections-panel] {
          transform: translateX(0);
        }

        #nc-root header[role="banner"],
        #nc-root header[role="toolbar"],
        #nc-root [class*="EditorHeader"],
        #nc-root [class*="CollectionHeader"] {
          display: flex !important;
          flex-direction: column !important;
          align-items: stretch !important;
          gap: 0.75rem !important;
          width: 100% !important;
        }

        #nc-root header[role="banner"] > *,
        #nc-root header[role="toolbar"] > *,
        #nc-root [class*="EditorHeader"] > *,
        #nc-root [class*="CollectionHeader"] > * {
          width: 100% !important;
          max-width: 100% !important;
        }

        #nc-root nav[role="navigation"],
        #nc-root [class*="EditorToolbar"],
        #nc-root [class*="HeaderToolbar"],
        #nc-root [class*="CollectionControls"] {
          display: flex !important;
          flex-wrap: wrap !important;
          justify-content: flex-start !important;
          gap: 0.6rem !important;
        }

        #nc-root nav[role="navigation"] a,
        #nc-root nav[role="navigation"] button,
        #nc-root [class*="EditorToolbar"] > *,
        #nc-root [class*="HeaderToolbar"] > * {
          flex: 1 1 140px !important;
          min-width: 0 !important;
        }

        #nc-root .nc-editor-status,
        #nc-root [class*="EditorStatus"] {
          order: -1;
        }

        #nc-root [class*="ControlPane"] label {
          font-size: 0.85rem !important;
        }

        #nc-root [class*="ControlPane"] textarea,
        #nc-root [class*="ControlPane"] input {
          min-height: 42px;
        }

        #nc-root [data-testid="editor-pane"],
        #nc-root main,
        #nc-root [role="main"] {
          margin-left: 0 !important;
          width: 100% !important;
          max-width: 100% !important;
        }

        #nc-root [data-testid="app-container"],
        #nc-root [data-testid="workspace"],
        #nc-root [class*="Layout"],
        #nc-root [class*="Container"] {
          flex-direction: column !important;
          align-items: stretch !important;
          width: 100% !important;
        }

        #nc-root [class*="Pane"],
        #nc-root [class*="EditorPane"] {
          max-width: 100% !important;
        }

        #nc-root [class*="MediaLibrary"],
        #nc-root [role="dialog"] {
          width: 100% !important;
          max-width: 100% !important;
          left: 0 !important;
          right: 0 !important;
          margin: 0 !important;
        }

        #nc-root [role="dialog"] .nc-media-library-content,
        #nc-root [role="dialog"] [class*="MediaLibraryContent"] {
          max-width: 100% !important;
        }

        #nc-root [role="dialog"] button,
        #nc-root [role="dialog"] input,
        #nc-root [role="dialog"] label {
          font-size: 16px !important;
        }
      }
    </style>
