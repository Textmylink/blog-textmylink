<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TextMyLink CMS</title>
  </head>
  <body>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script>
      if (window.netlifyIdentity) {
        window.netlifyIdentity.on("init", function (user) {
          if (!user) {
            window.netlifyIdentity.on("login", function () {
              document.location.href = "/admin/";
            });
          }
        });
      }
    </script>
    <script>
      window.process = window.process || { env: { NODE_ENV: "production" } };
      window.CMS_MANUAL_INIT = true;
    </script>
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
    <script>
      (function initCms() {
        if (window.CMS && typeof window.CMS.init === "function") {
          window.CMS.init();
          setupIdentityUI();
          setupMobileEnhancements();
          return;
        }
        if (window.NetlifyCmsApp && typeof window.NetlifyCmsApp.init === "function") {
          window.NetlifyCmsApp.init();
          setupIdentityUI();
          setupMobileEnhancements();
          return;
        }
        const message = "Netlify CMS failed to load. Check the browser console for details.";
        console.error(message);
        document.body.insertAdjacentHTML("beforeend", `<p>${message}</p>`);
      })();

      function setupIdentityUI() {
        if (!window.netlifyIdentity) {
          return;
        }

        const hideModalTabs = () => {
          const modal = document.querySelector(".netlify-identity-modal");
          if (!modal) return;

          const tabs = modal.querySelector("[data-netlify-identity-menu]");
          if (tabs) {
            tabs.style.display = "none";
          }

          const links = modal.querySelectorAll("[data-netlify-identity-button]");
          links.forEach((button) => {
            const text = (button.textContent || "").toLowerCase();
            if (text.includes("sign up") || text.includes("signup") || text.includes("register")) {
              button.remove();
            }
          });

          const heading = modal.querySelector(".netlify-identity-title");
          if (heading) {
            heading.textContent = "Log in";
          }
        };

        window.netlifyIdentity.on("open", () => {
          hideModalTabs();
          const observer = new MutationObserver(() => hideModalTabs());
          const modal = document.querySelector(".netlify-identity-modal");
          if (modal) {
            observer.observe(modal, { childList: true, subtree: true });
          }
        });
      }

      function setupMobileEnhancements() {
        const MOBILE_QUERY = window.matchMedia("(max-width: 900px)");
        const state = {
          button: null,
          overlay: null,
          nav: null,
          navParent: null,
          navNextSibling: null
        };

        let applyScheduled = false;

        const applyTweaks = () => {
          applyScheduled = false;
          const root = document.getElementById("nc-root");
          if (!root) return;

          const isMobile = MOBILE_QUERY.matches;
          const sidebar = findSidebar(root);

          if (sidebar) {
            if (isMobile) {
              ensureMobileNav(sidebar, state);
            } else {
              resetMobileNav(sidebar, state);
            }
          } else {
            resetMobileNav(null, state);
          }

          const layout = sidebar ? findFlexParent(sidebar) : null;
          if (layout) {
            if (isMobile) {
              applyMobileStyles(layout, {
                display: "block",
                width: "100%",
                gridTemplateColumns: "minmax(0, 1fr)",
                margin: "0"
              });
            } else {
              resetMobileStyles(layout);
            }
          }

          const mainPane =
            root.querySelector('[data-testid="editor-pane"]') ||
            root.querySelector("[role='main']") ||
            root.querySelector("main");
          if (mainPane) {
            if (isMobile) {
              applyMobileStyles(mainPane, {
                marginLeft: "0",
                width: "100%",
                maxWidth: "100%",
                gridColumn: "1 / -1",
                paddingLeft: "0",
                paddingRight: "0"
              });
            } else {
              resetMobileStyles(mainPane);
            }
          }

          const modal = findMediaModal();
          if (modal) {
            if (isMobile) {
              applyMobileStyles(modal, {
                width: "100%",
                maxWidth: "100%",
                left: "0",
                right: "0",
                margin: "0",
                height: "100%",
                maxHeight: "100%"
              });

              const modalContent =
                modal.querySelector(".nc-media-library-content") ||
                modal.querySelector("[class*='MediaLibraryContent']");
              if (modalContent) {
                applyMobileStyles(modalContent, { maxWidth: "100%" });
              }
            } else {
              resetMobileStyles(modal);
              const modalContent =
                modal.querySelector(".nc-media-library-content") ||
                modal.querySelector("[class*='MediaLibraryContent']");
              if (modalContent) {
                resetMobileStyles(modalContent);
              }
            }
          }

          if (!isMobile) {
            setCollectionsOpen(false, state);
          }
        };

        const scheduleApply = () => {
          if (applyScheduled) return;
          applyScheduled = true;
          requestAnimationFrame(applyTweaks);
        };

        const observer = new MutationObserver(() => scheduleApply());
        const observeRoot = () => {
          const root = document.getElementById("nc-root");
          if (!root) {
            requestAnimationFrame(observeRoot);
            return;
          }
          observer.observe(root, { childList: true, subtree: true });
          scheduleApply();
        };

        observeRoot();
        if (typeof MOBILE_QUERY.addEventListener === "function") {
          MOBILE_QUERY.addEventListener("change", scheduleApply);
        } else if (typeof MOBILE_QUERY.addListener === "function") {
          MOBILE_QUERY.addListener(scheduleApply);
        }
        window.addEventListener("resize", scheduleApply, { passive: true });
        document.addEventListener("keydown", (event) => {
          if (event.key === "Escape") {
            setCollectionsOpen(false, state);
          }
        });
      }

      function applyMobileStyles(element, styles) {
        if (!element) return;
        if (element.dataset.mobileOriginalStyle === undefined) {
          element.dataset.mobileOriginalStyle = element.getAttribute("style") || "";
        }
        Object.assign(element.style, styles);
      }

      function resetMobileStyles(element) {
        if (!element || element.dataset.mobileOriginalStyle === undefined) {
          return;
        }
        const original = element.dataset.mobileOriginalStyle;
        if (original) {
          element.setAttribute("style", original);
        } else {
          element.removeAttribute("style");
        }
        delete element.dataset.mobileOriginalStyle;
      }

      function ensureMobileNav(nav, state) {
        if (!nav) return;
        if (nav.dataset.mobileOriginalStyleNav === undefined) {
          nav.dataset.mobileOriginalStyleNav = nav.getAttribute("style") || "";
        }
        if (!nav.id) {
          nav.id = "cms-mobile-collections-panel";
        }
        nav.dataset.mobileCollectionsPanel = "true";
        state.nav = nav;
        if (!state.navParent) {
          state.navParent = nav.parentNode;
          state.navNextSibling = nav.nextSibling;
        }
        if (nav.parentNode !== document.body) {
          document.body.appendChild(nav);
        }
        nav.setAttribute("tabindex", "-1");

        const button = ensureMobileNavButton(state, nav.id);
        const overlay = ensureMobileNavOverlay(state);
        state.button = button;
        state.overlay = overlay;

        nav.setAttribute(
          "aria-hidden",
          document.body.classList.contains("cms-collections-open") ? "false" : "true"
        );

        if (!nav.dataset.mobileNavBound) {
          nav.dataset.mobileNavBound = "true";
          nav.addEventListener("click", (event) => {
            if (event.target.closest("a, button")) {
              setCollectionsOpen(false, state);
            }
          });
        }
      }

      function resetMobileNav(nav, state) {
        const panel = nav || state.nav;
        if (panel) {
          delete panel.dataset.mobileCollectionsPanel;
          panel.removeAttribute("aria-hidden");
          panel.removeAttribute("tabindex");
          if (state.navParent && panel.parentNode !== state.navParent) {
            if (state.navNextSibling && state.navNextSibling.parentNode === state.navParent) {
              state.navParent.insertBefore(panel, state.navNextSibling);
            } else {
              state.navParent.appendChild(panel);
            }
          }
          if (panel.dataset.mobileNavBound) {
            delete panel.dataset.mobileNavBound;
          }
          if (panel.dataset.mobileOriginalStyleNav !== undefined) {
            const original = panel.dataset.mobileOriginalStyleNav;
            if (original) {
              panel.setAttribute("style", original);
            } else {
              panel.removeAttribute("style");
            }
            delete panel.dataset.mobileOriginalStyleNav;
          }
        }
        setCollectionsOpen(false, state);
      }

      function ensureMobileNavButton(state, controlsId) {
        let button = document.getElementById("cms-mobile-collections-button");
        if (!button) {
          button = document.createElement("button");
          button.id = "cms-mobile-collections-button";
          button.type = "button";
          button.setAttribute("aria-haspopup", "true");
          button.innerHTML = '<span aria-hidden="true">☰</span> Collections';
          document.body.appendChild(button);
          button.addEventListener("click", () => {
            const shouldOpen = !document.body.classList.contains("cms-collections-open");
            setCollectionsOpen(shouldOpen, state);
          });
        }
        if (controlsId) {
          button.setAttribute("aria-controls", controlsId);
        }
        button.setAttribute(
          "aria-expanded",
          document.body.classList.contains("cms-collections-open") ? "true" : "false"
        );
        return button;
      }

      function ensureMobileNavOverlay(state) {
        let overlay = document.getElementById("cms-mobile-collections-overlay");
        if (!overlay) {
          overlay = document.createElement("div");
          overlay.id = "cms-mobile-collections-overlay";
          overlay.style.display = "none";
          document.body.appendChild(overlay);
        }
        if (!overlay.dataset.mobileBound) {
          overlay.dataset.mobileBound = "true";
          overlay.addEventListener("click", () => setCollectionsOpen(false, state));
        }
        overlay.style.display = document.body.classList.contains("cms-collections-open") ? "block" : "none";
        return overlay;
      }

      function setCollectionsOpen(open, state) {
        const body = document.body;
        if (open) {
          body.classList.add("cms-collections-open");
        } else {
          body.classList.remove("cms-collections-open");
        }
        if (state.button) {
          state.button.setAttribute("aria-expanded", open ? "true" : "false");
        }
        if (state.nav) {
          state.nav.setAttribute("aria-hidden", open ? "false" : "true");
          state.nav.setAttribute("tabindex", open ? "0" : "-1");
        }
        if (state.overlay) {
          state.overlay.style.display = open ? "block" : "none";
        }
      }

      function findSidebar(root) {
        const navCandidates = root.querySelectorAll("[role='navigation'], aside");
        for (const el of navCandidates) {
          const text = el.textContent || "";
          if (text.toLowerCase().includes("collections")) {
            return el;
          }
        }
        return navCandidates[0] || null;
      }

      function findFlexParent(element) {
        let current = element.parentElement;
        while (current) {
          const style = window.getComputedStyle(current);
          if (style.display.includes("flex")) {
            return current;
          }
          current = current.parentElement;
        }
        return null;
      }

      function findMediaModal() {
        const dialogs = document.querySelectorAll("[role='dialog'], [data-testid*='modal']");
        for (const dialog of dialogs) {
          const text = (dialog.getAttribute("aria-label") || dialog.textContent || "").toLowerCase();
          if (text.includes("media library") || text.includes("upload")) {
            return dialog;
          }
        }
        return null;
      }
    </script>
  </body>
</html>
    <style>
      #cms-mobile-collections-button,
      #cms-mobile-collections-overlay {
        display: none;
      }

      @media (max-width: 900px) {
        body.cms-collections-open {
          overflow: hidden;
        }

        #nc-root {
          overflow-x: hidden;
        }

        #cms-mobile-collections-button {
          position: fixed;
          top: 0.75rem;
          right: 0.75rem;
          z-index: 1003;
          display: inline-flex;
          align-items: center;
          gap: 0.5rem;
          padding: 0.55rem 0.95rem;
          border-radius: 999px;
          border: none;
          background: #1f2937;
          color: #fff;
          font-size: 0.95rem;
          font-weight: 600;
          box-shadow: 0 16px 38px rgba(15, 23, 42, 0.24);
          cursor: pointer;
        }

        #cms-mobile-collections-button span[aria-hidden="true"] {
          font-size: 1.15rem;
          line-height: 1;
        }

        body.cms-collections-open #cms-mobile-collections-button {
          background: #3730a3;
        }

        #cms-mobile-collections-overlay {
          position: fixed;
          inset: 0;
          background: rgba(15, 23, 42, 0.35);
          z-index: 1001;
        }

        body.cms-collections-open #cms-mobile-collections-overlay {
          display: block;
        }

        #nc-root [data-mobile-collections-panel] {
          position: fixed !important;
          top: 0;
          left: 0;
          bottom: 0;
          width: min(82vw, 320px);
          max-width: 92vw;
          background: #ffffff;
          z-index: 1002;
          transform: translateX(-110%);
          transition: transform 0.25s ease;
          box-shadow: 12px 0 32px rgba(15, 23, 42, 0.28);
          padding: 1.25rem 1rem;
          overflow-y: auto;
        }

        body.cms-collections-open #nc-root [data-mobile-collections-panel] {
          transform: translateX(0);
        }

        #nc-root [data-testid="editor-pane"],
        #nc-root main,
        #nc-root [role="main"] {
          margin-left: 0 !important;
          width: 100% !important;
          max-width: 100% !important;
        }

        #nc-root [data-testid="app-container"],
        #nc-root [data-testid="workspace"],
        #nc-root [class*="Layout"],
        #nc-root [class*="Container"] {
          flex-direction: column !important;
          align-items: stretch !important;
          width: 100% !important;
        }

        #nc-root [class*="Pane"],
        #nc-root [class*="EditorPane"] {
          max-width: 100% !important;
        }

        #nc-root [class*="MediaLibrary"],
        #nc-root [role="dialog"] {
          width: 100% !important;
          max-width: 100% !important;
          left: 0 !important;
          right: 0 !important;
          margin: 0 !important;
        }

        #nc-root [role="dialog"] .nc-media-library-content,
        #nc-root [role="dialog"] [class*="MediaLibraryContent"] {
          max-width: 100% !important;
        }

        #nc-root [role="dialog"] button,
        #nc-root [role="dialog"] input,
        #nc-root [role="dialog"] label {
          font-size: 16px !important;
        }
      }
    </style>
